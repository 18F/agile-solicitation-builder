language: python
sudo: false
python:
- 3.5.1
env:
  global:
  - CF_USERNAME=18f-acq_deployer
  - secure: TycLYHwPozEtmLOz0ukWHt0UWjWTcArLqTWfuAT0AFmBCCkKECaxI899T5o4CX6+cYkjHg8/Y57PIp8DtKS69AWBM7l4TtuO8V6ZIgahRosnvqPFrRFNnUWHDX/zQnzV4GdUqGARSBMp8H5KwDiYHHJ6v9sVNydhYyzIdPvJS2YrStjD8V+g8QU53quWM8y73lcCMK/NQlPyIZKLtvaMA/2z+ncv18sGCvgAuY2cYAq9tvJHLC+zHtE9r0OvqK3A8tYqUsqyPDLRoS/oE3c+tZpScb/dnREKoyRTEdArUEHOxfZIs1w+i3ZDE3B9uEDGGdKVSHvgexvTJI3XwX1yu64G/h9UGMSRCqnHSbxCxDrggEL120D8p9hqtX34GpbIIh1JwIAR00vSOd4acXho2lG7w1UqGD8vyjTPFzJC+V8t1BYoKfmYL09Vdj6vVMRS0qQ2fxxhqB7jqH1pUg0LgItLeHcx+d51nYg4Xi2mrzdT/BxHcQIBRw9Ahx4eHmR+w8hbhufHutgkIqkOz5WSa9sMsInzFtS+HGTPiy71cHZfD/Pn51BgXrqP58HcSPBlaKmyPleUoTxet2TOB0NDQwqQg4/frzFTzTBjpBh/v0PdHVNc1IbrPY/DehuX3bE+vbJqOlnBwWBux/HA1gvfhkZBDwCdp+D++srkJXqX5dU=
install:
- pip install -r requirements.txt
- npm --prefix ./app install ./app
- psql -c 'create database travis_ci_test;' -U postgres
script:
- python tests.py
before_deploy:
- export PATH=$HOME:$PATH
- travis_retry curl -L -o $HOME/cf.tgz "https://cli.run.pivotal.io/stable?release=linux64-binary&version=6.15.0"
- tar xzvf $HOME/cf.tgz -C $HOME
- mkdir -p ${HOME}/Godeps/_workspace
- export GOPATH=${HOME}/Godeps/_workspace
- go get github.com/concourse/autopilot
- cf install-plugin -f $GOPATH/bin/autopilot
deploy:
- provider: script
  script: "./deploy.sh staging"
  skip_cleanup: true
  on:
    branch: develop
- provider: script
  script: "./deploy.sh production"
  skip_cleanup: true
  on:
    branch: master

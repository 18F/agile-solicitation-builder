language: python
sudo: false
python:
- 3.5.1
node:
env:
  global:
  - CF_USERNAME=18f-acq_deployer
  - secure: "Yfn7cgcs84EDit9zmP28vjDKzThIyvfg3Himwag+mMIBuSQuFhZGQsWPeNWzJmXXLHgZGj4kzLgJVUvc8D+q1uG2B3161AXE9gRMnByzgiHd0+cf1Qyx2x0RhXVaHgwg8o2xH9gcjWuuXQuJAISdbmPaEiOkCNCiA3IVjBRnzJiOAt3U2rrqzaYj0NDvPgyuGec1S1ROnBxAhfTUWOlefyZ4Cr2yN8su7/8GenLh9OJVMo0lTYD7UUwMdzHbJQg4oVMxhR/QWAP5Z06YJnRQr8pVmaiZyloifiHa5kK7vOV0AASmPaKybdyyc5R/fTtjI6C5XPeLH9gFkwgZZrod48zXLTtsvX4szg/D0KYhI9d8Nf0OcTO5sAHjAg+gzcHEGGjnxGnYr4uED1fYiWvVL0GCo1q9XrVQfzrEeMqLkpp0MnxwEvz/MNLXDj5gTIdftEWK14kmtKVEz6D6Cf8onv3Ca2K2ro2XsIFgvUjp9sZ8dPY98qj6vOu/wIXYM+eWh+BKpw98e+so+Cq/uU3B8S+z46yp1FXOd9Xp38lp1IpyDWR7t0ZaoAAF2nYBp/99E00qajUSoTbM2mo92H4SqMeFP25Y+e2CDHcizVIRsaBF1K3Oz1FD7fRvxLIIhKLJNKRLeQ5mkQk3k4votv+uQzVLsKjhOZPiMyWCWQsicgs="
before_install:
  - rm -rf ~/.nvm && git clone https://github.com/creationix/nvm.git ~/.nvm && (cd ~/.nvm && git checkout `git describe --abbrev=0 --tags`) && source ~/.nvm/nvm.sh && nvm install 6.1.0
install:
- pip install -r requirements.txt
- cd web
- npm install
- cd ..
- psql -c 'create database travis_ci_test;' -U postgres
script:
- nosetests
before_deploy:
- export PATH=$HOME:$PATH
- travis_retry curl -L -o $HOME/cf.tgz "https://cli.run.pivotal.io/stable?release=linux64-binary&version=6.15.0"
- tar xzvf $HOME/cf.tgz -C $HOME
- cf install-plugin autopilot -f -r CF-Community
cache: pip
deploy:
- provider: script
  script: "./deploy.sh staging"
  skip_cleanup: true
  on:
    branch: develop
- provider: script
  script: "./deploy.sh production"
  skip_cleanup: true
  on:
    branch: master
